// Copyright 2013 Axel Rasmussen
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// The sequence of triangle numbers is generated by adding the natural numbers.
// So the 7th triangle number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. The
// first ten terms would be:
//
// 1, 3, 6, 10, 15, 21, 28, 36, 45, 55, ...
//
// Let us list the factors of the first seven triangle numbers:
// 1: 1
// 3: 1,3
// 6: 1,2,3,6
// 10: 1,2,5,10
// 15: 1,3,5,15
// 21: 1,3,7,21
// 28: 1,2,4,7,14,28
//
// We can see that 28 is the first triangle number to have over five divisors.
// What is the value of the first triangle number to have over five hundred
// divisors?

extern crate euler;
use self::euler::math::division;
use self::euler::math::sequence;
use self::euler::util::error::*;
use self::euler::util::problem::*;

const EXPECTED_RESULT: u64 = 76576500;

// This is the smallest number that has exactly 500 factors -- we use this as
// our lower-bound. The theory behind how this number was calculated is
// described here:
// http://www.primepuzzles.net/problems/prob_019.htm
const MINIMUM_NUMBER: u64 = 62370000;

const TARGET_NUM_DIVISORS: u64 = 500;

fn main() {
    main_impl(|| -> Result<ProblemAnswer<u64>> {
        let (mut idx, mut value) =
            sequence::sequence_search(1, MINIMUM_NUMBER, sequence::get_nth_triangle_number);
        while division::aliquot_number_divisors(value) <= TARGET_NUM_DIVISORS {
            idx += 1;
            value = sequence::get_nth_triangle_number(idx);
        }

        Ok(ProblemAnswer {
            actual: value,
            expected: EXPECTED_RESULT,
        })
    });
}
